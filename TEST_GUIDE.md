# 測試指南 - 不需要 LINE Bot

本指南說明如何在不串接 LINE Bot 的情況下測試 RAG 系統功能。

---

## 🎯 測試方式

我們提供了**兩種測試方式**,您可以選擇最適合的方式:

### 方式 1: 命令列介面 (CLI) ⌨️

適合喜歡使用終端機的開發者。

### 方式 2: 網頁介面 (Web UI) 🌐

適合喜歡視覺化介面的使用者,提供更友善的操作體驗。

---

## 📋 前置準備

### 1. 安裝依賴套件

```bash
cd d:\creditCard
pip install -r requirements.txt
```

### 2. 設定環境變數

建立 `.env` 檔案:

```env
GOOGLE_API_KEY=your_google_gemini_api_key
```

**注意**: 測試模式**不需要** LINE Bot 的 Channel Secret 和 Access Token!

### 3. 初始化向量資料庫

```bash
cd src
python init_db.py
```

---

## ⌨️ 方式 1: 命令列介面測試

### 啟動 CLI

```bash
cd src
python test_cli.py
```

### 可用指令

| 指令 | 說明 | 範例 |
|------|------|------|
| `help` | 查看說明 | `help` |
| `cards` | 查看所有可用信用卡 | `cards` |
| `add [卡片名稱]` | 新增信用卡 | `add 台新Richart卡` |
| `remove [卡片名稱]` | 移除信用卡 | `remove 台新Richart卡` |
| `list` | 查看已新增的卡片 | `list` |
| `clear` | 清除所有卡片 | `clear` |
| `exit` 或 `quit` | 離開程式 | `exit` |
| 直接輸入問題 | 查詢推薦 | `我要去加油` |

### 測試流程範例

```
💬 您: cards
🤖 Bot:
💳 可用的信用卡清單 (共 15 張):

  1. 台新Richart卡
  2. 國泰CUBE卡
  3. 中國信託LINE Pay卡
  ...

💬 您: add 台新Richart卡
🤖 Bot:
✅ 已新增「台新Richart卡」
您現在有 1 張信用卡。

💬 您: add 中國信託中油聯名卡
🤖 Bot:
✅ 已新增「中國信託中油聯名卡」
您現在有 2 張信用卡。

💬 您: list
🤖 Bot:
💳 您的信用卡 (共 2 張):

  1. 台新Richart卡
  2. 中國信託中油聯名卡

💬 您: 我要去加油
🤖 Bot:
🏆 推薦加油卡片 Top 3:

1. 中國信託中油聯名卡 - 4%
   ⚠️ 需搭配中油Pay儲值
   📅 優惠至 2026-05-31

2. 台新Richart卡 - 3.3%
   ⚠️ 需在「Richart Life APP」切換為「天天刷」方案
   📅 優惠至 2026-06-30

💬 您: exit
👋 再見!
```

---

## 🌐 方式 2: 網頁介面測試

### 啟動 Web UI

```bash
cd src
python test_web.py
```

### 開啟瀏覽器

啟動後,開啟瀏覽器訪問:

```
http://localhost:8000
```

### 功能說明

網頁介面提供以下功能:

#### 1. 卡片管理區域
- 📋 顯示已新增的信用卡清單
- ➕ 新增信用卡 (輸入卡片名稱)
- 🗑️ 移除信用卡 (點擊「移除」按鈕)
- 📜 查看所有可用信用卡 (點擊「查看所有卡片」)

#### 2. 對話查詢區域
- 💬 輸入問題查詢推薦
- ⚡ 快速查詢按鈕:
  - 🚗 加油
  - 🛒 網購
  - 🍽️ 餐廳
  - 🏪 超商
- 📜 顯示對話歷史

### 測試流程範例

1. **新增信用卡**:
   - 在「我的信用卡」區域輸入「台新Richart卡」
   - 點擊「新增」按鈕
   - 重複步驟新增更多卡片

2. **查詢推薦**:
   - 在「查詢推薦」區域輸入「我要去加油」
   - 點擊「查詢」按鈕或按 Enter
   - 查看 Bot 的推薦結果

3. **使用快速查詢**:
   - 點擊「🚗 加油」按鈕
   - 自動填入問題並查詢

---

## 🔄 測試完成後切換到 LINE Bot

測試完成後,要切換到正式的 LINE Bot 模式:

### 1. 設定 LINE Bot 環境變數

在 `.env` 檔案中新增:

```env
LINE_CHANNEL_SECRET=your_line_channel_secret
LINE_CHANNEL_ACCESS_TOKEN=your_line_channel_access_token
```

### 2. 啟動 LINE Bot 模式

```bash
cd src
python main.py
```

### 3. 設定 Webhook

使用 ngrok 或部署到雲端:

```bash
# 使用 ngrok (本地測試)
ngrok http 8000

# 將 ngrok 提供的 URL 設定到 LINE Developers Console
# Webhook URL: https://your-ngrok-url.ngrok-free.app/webhook
```

詳細部署步驟請參考 [DEPLOYMENT.md](DEPLOYMENT.md)

---

## 🧪 測試案例建議

### 基本功能測試

1. **新增卡片**
   - 新增有效的卡片名稱
   - 新增不存在的卡片名稱 (應顯示錯誤)
   - 重複新增同一張卡片 (應顯示警告)

2. **移除卡片**
   - 移除已新增的卡片
   - 移除不存在的卡片 (應顯示錯誤)

3. **查看清單**
   - 查看空清單
   - 查看有卡片的清單

### RAG 查詢測試

測試不同的消費場景:

| 場景 | 測試問題 | 預期結果 |
|------|---------|---------|
| 加油 | 我要去加油 | 推薦中油聯名卡、滙豐匯鑽卡等 |
| 網購 | 網購要用哪張卡 | 推薦 UBear 卡、LINE Pay 卡等 |
| 餐廳 | 餐廳吃飯推薦 | 推薦 CUBE 卡、Richart 卡等 |
| 超商 | 超商消費 | 推薦 Richart 卡等 |
| 旅遊 | 我要出國 | 推薦 Richart 卡、滙豐卡等 |

### 邊界測試

1. **空持卡清單**
   - 不新增任何卡片直接查詢
   - 應提示先新增信用卡

2. **模糊查詢**
   - 輸入不明確的問題
   - 測試 RAG 系統的理解能力

3. **APP 切換提醒**
   - 新增需要切換 APP 的卡片 (台新 Richart、國泰 CUBE)
   - 查詢推薦時應顯示切換提醒

---

## ❓ 常見問題

### Q1: 測試介面無法啟動

**A**: 檢查以下項目:
1. 是否已設定 `GOOGLE_API_KEY` 環境變數
2. 是否已執行 `python init_db.py` 初始化向量資料庫
3. 是否已安裝所有依賴套件 (`pip install -r requirements.txt`)

### Q2: 查詢沒有推薦結果

**A**: 
1. 確認已新增信用卡到清單
2. 檢查查詢的消費場景是否在資料庫中有對應的回饋方案
3. 查看終端機的錯誤訊息

### Q3: 推薦結果不準確

**A**:
1. 檢查 `信用卡資料模板.csv` 的資料是否正確
2. 重新執行 `python init_db.py` 更新向量資料庫
3. 調整查詢問題,使用更明確的關鍵字

### Q4: 測試模式和 LINE Bot 模式有什麼差別?

**A**:
- **測試模式**: 使用本地使用者 ID (`test_user`),資料儲存在本地資料庫
- **LINE Bot 模式**: 使用 LINE 使用者 ID,每位使用者有獨立的卡片清單
- **核心 RAG 功能完全相同**,只是使用者介面不同

---

## 📊 測試檢查清單

測試完成前,請確認以下項目:

- [ ] 可以成功新增信用卡
- [ ] 可以成功移除信用卡
- [ ] 可以查看持有卡片清單
- [ ] 可以查詢加油推薦
- [ ] 可以查詢網購推薦
- [ ] 可以查詢餐廳推薦
- [ ] APP 切換提醒正確顯示
- [ ] 回饋到期日正確顯示
- [ ] Top 3 排序正確
- [ ] 空持卡清單會提示新增卡片

---

## 🎉 測試完成!

測試完成後,您可以:

1. ✅ 確認 RAG 系統運作正常
2. ✅ 開始設定 LINE Bot 進行正式部署
3. ✅ 自訂信用卡資料 (`信用卡資料模板.csv`)
4. ✅ 調整提示詞模板 (`prompt_templates.py`)

祝您測試順利! 🚀
